# ローカル環境での開発
このドキュメントではローカル環境の開発環境構築について説明します。

### 必要なもの
- VM環境の秘密鍵: app-{チーム名}.pem という形式のファイル (各チームに配布予定です)
- VMのドメイン: app-{チーム名}.hutc2511.dabaas.net (上記秘密鍵の名前から特定できます)
- VMのパブリックIPアドレス：xxx.xxx.xxx.xxxという形式のアドレス（各チームに共有予定です）

## 注意事項
- お使いのPC環境によってはローカルでの環境構築が困難な場合もあります。LinuxもしくはMacOSでの環境構築を前提としているため、**特にWindowsユーザの場合はWSLを使用してUbuntuなどのLinux系のOSでの環境構築を勧めます。**　WSLが入っていない場合は、[microsoft store](https://apps.microsoft.com/detail/9NZ3KLHXDJP5?hl=neutral&gl=JP&ocid=pdpshare)のリンクから、インストールしてください。
また、エラーが発生した場合は、このページ下部の"WSL利用時のチェック"の項目を参考にしてください。

## 事前準備

- Dockerで環境構築をするため、下記リンクからDocker Desktopのインストールをお願いします。
    - Mac：https://docs.docker.com/desktop/install/mac-install/
    - Windows：https://docs.docker.com/desktop/install/windows-install/

## 手順

1. ローカル環境に、 fork したリポジトリをクローンし、ルートディレクトリにある `init.sh` を実行してください。

    ```bash
    $ git clone {forkしたリポジトリのURL}
    $ cd {cloneしたリポジトリのディレクトリ}
    $ bash init.sh {VMのパブリックIPアドレス} {秘密鍵のパス}
    ```

    「初期化に成功しました。」という出力がされていることを確認し、http://localhost/login にアクセスして画面が表示されるか確認してみてください。
    ログイン時に必要なid, passwordは [サービス概要](../app/01_Service.md) を参照してください。

    **※初回起動時は docker build のキャッシュがないため、コンテナの起動に時間がかかる可能性があります。**

2. 配布された秘密鍵を 各自の PC の任意の場所に置き、アクセス権限を設定してください。

   ```bash
   $ chmod 400 {秘密鍵のパス}
   ```

3. 秘密鍵に対応した VM のパブリック IP アドレスを利用して、環境にssh接続してください。

   ```bash
   $ ssh -i {秘密鍵のパス} azureuser@{VMのパブリックIPアドレス}
   ```


1. 評価スクリプトを動かしてください。実行が完了し、以下の表示が出力されればローカルでの環境構築は完了です。

    ```bash
    $ bash run.sh
    ===================================================


    負荷試験が完了しました！！！
    あなたのスコア: 0


    ===================================================
    ```

## WSL利用時のチェック
- WSL上に、unzipコマンドが初期状態で入っていないことがあります。その場合、unzip をインストールしてください。
- docker の実行がデフォルトで、WSL上のユーザに許可されていない（WSL上で、 `docker ps`等のコマンドが実行できていれば許可されています。）ことがあります。その場合、`sudo usermod -a -G docker {ユーザ名}`を実行し、現在ログイン中のWSLユーザへdocker コマンド実行権限を付与してください。

### ローカル環境と VM 環境の違い

- ローカル環境では localhost を使って通信を行うため、負荷試験時に https 通信は行われません。
- ローカル環境と VM 環境で利用するアプリの compose ファイルは異なるので注意してください。ローカル環境で使用される compose ファイルは`webapp/docker-compose.local.yml`です。
- ローカル環境では評価スクリプトを実施してもスコアを運営に送信しないため、コンテストの結果には影響しません。コンテストのスコアを更新したい場合は、VM 環境で評価スクリプトを実施してください。
- ローカル環境とVM環境では、データ数が異なります。そのため、負荷試験のスコアに大きな差が出ることがありますが、正常です。

---

[トップ](../../../README.md)
